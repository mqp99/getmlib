<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Live Cove with MLib</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="assets/sass/codemirror.css">
	<link rel="stylesheet" href="assets/sass/neat.css">
	<style>
		*,
		*:focus {
			outline: none;
			box-sizing: border-box;
		}
		body {
			margin: 0;
			padding: 0;
		}
		.CodeMirror {
			height: 50vh;
			border: 1px solid #e8e8e8;
		}
		.container {
			width: 100%;
			display: flex;
		}
		.container-box {
			width: 60%;
			display: flex;
			flex-direction: column;
		}
		.innerBox {
			width: 100%;
			resize: none;
			height: 50vh;
			padding: 5px 10px;
			font-size: 1.05rem;
			border: 1px solid #c8c8c8;
		}
		.innerBoxPreview {
			width: 40%;
			min-width: 500px;
			border: 1px solid #c8c8c8;
		}
		iframe {
			width: 100%;
			height: 100%;
		}
		.auto-save {
			position: fixed;
			top: -35px;
			left: 50%;
			color: #fff;
			font-size: 15px;
			padding: 4px 10px;
			visibility: hidden;
			outline: 0;
			background: #f7a326;
			transform: translateX(-50%);
			box-shadow: 0 0 .5rem rgba(0,0,0,.2);
			border-bottom-right-radius: 5px;
			border-bottom-left-radius: 5px;
			transition: .3s;
			z-index: 9999999;
		}
		.auto-save.active {
			visibility: visible;
			opacity: 1;
			top: 0;
			z-index: 9999999;
		}
		@media (max-width: 900px) {
			.CodeMirror {
				width: 50%;
			}
			.container {
				display: inherit;
			}
			.container-box {
				width: 100%;
				flex-direction: row;
			}
			.innerBoxPreview {
				width: 100%;
				height: 50vh;
				border: 1px solid #c8c8c8;
			}
		}
		@media (max-width: 500px) {
			.CodeMirror {
				width: 100%;
			}
			.container {
				display: inherit;
			}
			.container-box {
				width: 100%;
				flex-wrap: wrap;
			}
			.innerBoxPreview {
				width: 100%;
				height: 50vh;
				min-width: 100%;
				border: 1px solid #c8c8c8;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="container-box">
			<textarea class="innerBox innerHTML" placeholder="HTML here..."></textarea>
			<textarea class="innerBox innerCSS" placeholder="CSS here..."></textarea>
		</div>
		<div class="innerBoxPreview">
			<iframe frameborder="0" id="liveUpdate">
				<!DOCTYPE html>
				<html>
					<head lang="vi">
						<meta charset="utf=8">
						<style></style>
					</head>
					<body>
						<h1>222</h1>
					</body>
				</html>
			</iframe>
		</div>
		<div class="auto-save">
			Đã lưu
		</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="assets/js/codemirror.js"></script>
	<script src="assets/js/javascript.js"></script>
	<script src="assets/js/htmlmixed.js"></script>
	<script src="assets/js/css.js"></script>
	<script>
		var codeHTML = $('.innerHTML')[0];
		var editor = CodeMirror.fromTextArea(codeHTML, {
		    tabSize:5,
		    theme: 'neat',
    		name: "text/html",
    		lineWrapping: true,
		});
		var codeCSS = $('.innerCSS')[0];
		var editorCSS = CodeMirror.fromTextArea(codeCSS, {
		    tabSize:5,
		    theme: 'neat',
		    mode: "text/css",
    		lineWrapping: true,
		});
	</script>
	<script>
		$(function () {
			var getRenderCode = localStorage.getItem('renderCode');
			if(localStorage.getItem("renderCode") === null) {
				var obj = { 'html': '<!-- HTML Here -->', 'css': '/* CSS Here */' };
				var renderCode = localStorage.setItem('renderCode',JSON.stringify(obj));
				var getRenderCode = JSON.parse(localStorage.getItem('renderCode'));
			}
			var getRenderCode = JSON.parse(localStorage.getItem('renderCode'));
			editor.setValue(getRenderCode.html);
			editorCSS.setValue(getRenderCode.css);
			function fetchHTML()
			{
				return html = editor.getValue();
			}
			function fetchCSS()
			{
				return css = editorCSS.getValue();
			}
			previewAndUpdate();
			editor.on('keyup',function(){
				previewAndUpdate()
			})
			editorCSS.on('keyup',function(){
				previewAndUpdate()
			})
			function previewAndUpdate()
			{
				var target = $('#liveUpdate')[0].contentWindow.document;
				target.open();
				target.close();
				var html = fetchHTML();
				var css = fetchCSS();
				setTimeout(()=>{
					$('body', target).html(html);
					$('head', target).html(`<link rel="stylesheet" href="https://mqp99.github.io/mlib/sass/mlib.min.css"><style>${css}</style>`);
				},500);
				setTimeout(()=>{
					var obj = {
						'html': html,
						'css': css
					};
					localStorage.setItem('renderCode',JSON.stringify(obj));
					//localStorage.setItem('html',html);
					$('.auto-save').addClass('active');
					setTimeout(()=>{ $('.auto-save').removeClass('active'); },1000);
				},2000);
			}
		})
	</script>
</body>
</html>