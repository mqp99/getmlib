<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Live Cove with MLib</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="https://mqp99.github.io/mlib/sass/mlib.min.css">
	<link rel="stylesheet" href="livecode/sass/codemirror.css">
	<link rel="stylesheet" href="livecode/sass/material-palenight.css">
	<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.2.0/css/all.css">
	<link rel="stylesheet" href="livecode/sass/livecode.css">
</head>
<body>
	<div class="container">
		<div class="container-box">
			<div class="toggle">
				<label>HTML</label>
				<span>&nbsp;</span>
			</div>
			<textarea class="innerBox innerHTML" placeholder="HTML here..."></textarea>
			<div class="toggle">
				<label>CSS</label>
				<div>
					<span class="setting-toggle"><i class="fal fa-plus"></i></span>
				</div>
			</div>
			<textarea class="innerBox innerCSS" placeholder="CSS here..."></textarea>
		</div>
		<div class="innerBoxPreview">
			<iframe frameborder="0" id="liveUpdate">
				<!DOCTYPE html>
				<html>
					<head lang="vi">
						<meta charset="utf=8">
						<style></style>
					</head>
					<body>
						<h1>222</h1>
					</body>
				</html>
			</iframe>
		</div>
		<div class="auto-save"></div>
		<div class="setting">
			<div class="settingCSS">
				<div class="header-setting">
					<span class="header-setting--title">Live Setting</span>
					<span class="header-setting--close setting-toggle"><i class="fal fa-times"></i></span>
				</div>
				<div class="body-setting">
					<div class="body-setting--left">
						<a href="#" class="setting-link active">CSS</a>
					</div>
					<div class="body-setting--right">
						<div class="component">
							<div class="component-title">Thêm liên kết</div>
							<div class="form-group">
								<input type="text" class="form-input focus-green addLinkStyle" placeholder="Eg: https://mqp99.github.io/mlib/sass/mlib.min.css">
								<button class="btn btn-green btn-sm btn-block btn-addLinkStyle">Thêm</button>
							</div>
						</div>
						<div class="component">
							<div class="component-title">Liên kết đã nhúng</div>
							<div class="form-group">
								<input type="text" class="form-input focus-green form-sm" placeholder="https://mqp99.github.io/mlib/sass/mlib.min.css" readonly disabled>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="livecode/js/codemirror.js"></script>
	<script src="livecode/js/javascript.js"></script>
	<script src="livecode/js/htmlmixed.js"></script>
	<script src="livecode/js/css.js"></script>
	<script>
		var codeHTML = $('.innerHTML')[0];
		var editor = CodeMirror.fromTextArea(codeHTML, {
    		lineNumbers: true,
		    tabSize:5,
		    theme: 'material-palenight',
    		name: "text/html",
    		lineWrapping: true,
		});
		var codeCSS = $('.innerCSS')[0];
		var editorCSS = CodeMirror.fromTextArea(codeCSS, {
    		lineNumbers: true,
		    tabSize:5,
		    theme: 'material-palenight',
		    mode: "text/css",
    		lineWrapping: true,
		});
	</script>
	<script>
		$(function () {
			/* 
				+ ADD LINK CSS
			*/
				$('.addLinkStyle').keyup(function(){
					_this = $(this).val();
					$('.addLinkStyle').removeClass('error')
					if($.trim(_this) != '') {
						$('.btn-addLinkStyle').fadeIn(100);
					}else{
						$('.btn-addLinkStyle').fadeOut(100);
					}
				})
				$('.setting-toggle').click(function(){
					$('.setting').toggleClass('active');
				})
				$('.btn-addLinkStyle').click(function(){
					var checkUrl = /(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/;
					var _valueThis = $('.addLinkStyle').val().trim();
					if ( checkUrl.test(_valueThis) ){
					    $('.addLinkStyle').removeClass('error')
					}else{
						$('.addLinkStyle').addClass('error')
					}
				})
			/* 
				+ END ADD LINK CSS
			*/
			var getRenderCode = localStorage.getItem('renderCode');
			if(localStorage.getItem("renderCode") === null) {
				var obj = { 'html': '<!-- HTML Here -->', 'css': '/* CSS Here */' };
				var renderCode = localStorage.setItem('renderCode',JSON.stringify(obj));
				var getRenderCode = JSON.parse(localStorage.getItem('renderCode'));
			}
			var getRenderCode = JSON.parse(localStorage.getItem('renderCode'));
			editor.setValue(getRenderCode.html);
			editorCSS.setValue(getRenderCode.css);
			function fetchHTML()
			{
				return html = editor.getValue();
			}
			function fetchCSS()
			{
				return css = editorCSS.getValue();
			}
			previewAndUpdate();
			editor.on('keyup',function(){
				previewAndUpdate()
			})
			editorCSS.on('keyup',function(){
				previewAndUpdate()
			})
			function previewAndUpdate()
			{
				var target = $('#liveUpdate')[0].contentWindow.document;
				target.open();
				target.close();
				var html = fetchHTML();
				var css = fetchCSS();
				setTimeout(()=>{
					$('body', target).html(html);
					$('head', target).html(`<link rel="stylesheet" href="https://mqp99.github.io/mlib/sass/mlib.min.css"><style>${css}</style>`);
				},500);
				setTimeout(()=>{
					var obj = {
						'html': html,
						'css': css
					};
					localStorage.setItem('renderCode',JSON.stringify(obj));
					//localStorage.setItem('html',html);
					$('.auto-save').html('Đang lưu...').addClass('active');
					setTimeout(()=>{ $('.auto-save').html('Đã lưu') },1500);
					setTimeout(()=>{ $('.auto-save').removeClass('active'); },2000);
				},2000);
			}
		})
	</script>
</body>
</html>