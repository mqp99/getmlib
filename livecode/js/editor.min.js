$((function(){var e,t,a=null!=y("renderCode")?y("renderCode"):[],n=null!=y("settingPage")?y("settingPage"):[],o=""!=n&&JSON.parse(n.autoSave),r=""!=n&&JSON.parse(n.useLibraryJS),s=""!=n?n.language:"en_us",i=$("#popup-alert"),l=$("#data-import"),u=$("#open-file-import"),c=$("#data-export"),g=o;""!=a||C("renderCode",{html:"",css:"",js:""});var m={vi_vn:{processing:'<label>Đang lưu &nbsp;</label><i class="fal fa-spin fa-spinner-third"></i>',processed:'<label>Đã lưu &nbsp;</label><i class="fal fa-check"></i>',status:'<label data-translate="_status">Trạng thái</label>',autosaveEnable:"Phải bật auto save và có nội dung!",tryagain:"Vui lòng thử lại!",jsonincorrect:"Vui lòng sử dụng đúng tệp JSON!",jsonnotallow:"JSON này không phải của chúng tôi!"},en_us:{processing:'<label>Code saving &nbsp;</label><i class="fal fa-spin fa-spinner-third"></i>',processed:'<label>Code saved &nbsp;</label><i class="fal fa-check"></i>',status:'<label data-translate="_status">Status</label>',autosaveEnable:"Turn on auto save and have code!",tryagain:"Please try again!",jsonincorrect:"Please use correct file JSON!",jsonnotallow:"This JSON is not allow!"}},d=CodeMirror.fromTextArea($("#htmlCode")[0],{lineNumbers:!0,tabSize:5,indentUnit:3,mode:"text/xml",keyMap:"sublime",profile:"xhtml",theme:"material-darker",lint:!0,lineWrapping:!0,autoCloseTags:!0,autoCloseBrackets:!0,matchTags:{bothTags:!0},extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-J":"toMatchingTag","Shift-F":function(){var e={from:d.getCursor(!0),to:d.getCursor(!1)};d.autoFormatRange(e.from,e.to)}}}),h=CodeMirror.fromTextArea($("#cssCode")[0],{lineNumbers:!0,tabSize:5,indentUnit:4,mode:"css",keyMap:"sublime",profile:"css",theme:"material-darker css",lineWrapping:!0,autoCloseBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete","Shift-F":function(){var e={from:h.getCursor(!0),to:h.getCursor(!1)};h.autoFormatRange(e.from,e.to)}}}),p=CodeMirror.fromTextArea($("#jsCode")[0],{lineNumbers:!0,tabSize:5,indentUnit:3,keyMap:"sublime",theme:"material-darker js",mode:"text/javascript",lint:!0,autoCloseBrackets:!0,lineWrapping:!0});function f(t,a,n){clearTimeout(e),e=setTimeout(()=>{!function(e,t){1==e&&1==t&&(b(),S(1e3));var a=d.getValue(),n=`<style type="text/css">${h.getValue()}</style>`,o=`<script type="text/javascript">${p.getValue()}<\/script>`,r=$("#preview-window").contents()[0];r.open(),r.write(n,a,o),r.close()}(a,n)},t)}function v(e=o,t=r,a=s){C("settingPage",{autoSave:e,useLibraryJS:r,language:s})}function b(e,t,a,n){C("renderCode",{html:d.getValue(),css:h.getValue(),js:p.getValue()})}function C(e,t){localStorage.setItem(e,JSON.stringify(t))}function y(e){var t=JSON.parse(localStorage.getItem(e));return t||[]}function S(e){clearTimeout(t),t=setTimeout(()=>{$(".menu-right .alert-processing").html(m[y("settingPage").language].processing)},e),t=setTimeout(()=>{$(".menu-right .alert-processing").html(m[y("settingPage").language].processed)},e+1e3),t=setTimeout(()=>{$(".menu-right .alert-processing").html(m[y("settingPage").language].status)},e+2e3)}emmetCodeMirror(d),emmetCodeMirror(h),$(document).on("click","#format-html",(function(){$(this).html("Formated"),setTimeout(()=>{$(this).html("Format")},1e3);var e=d.lineCount(),t=d.getValue().length;d.autoFormatRange({line:0,ch:0},{line:e,ch:t})})),$(document).on("click","#format-css",(function(){$(this).html("Formated"),setTimeout(()=>{$(this).html("Format")},1e3);var e=h.lineCount(),t=h.getValue().length;h.autoFormatRange({line:0,ch:0},{line:e,ch:t})})),v(),f(0,g,!1),1==g&&($("#auto-save").attr("data-save",!0).attr("checked",!0),""!=a&&(d.setValue(a.html),h.setValue(a.css),p.setValue(a.js))),d.on("keypress",(function(){})),h.on("keypress",(function(){CodeMirror.commands.autocomplete(h)})),p.on("keypress",(function(){CodeMirror.commands.autocomplete(p)})),d.on("change",(function(){f(1e3,g,!0)})),h.on("change",(function(){f(1e3,g,!0)})),p.on("change",(function(){f(1e3,g,!0)})),$(document).on("change","#auto-save",(function(){_this=$(this).attr("data-save"),"false"==_this?($(this).attr("data-save",!0),b(),S(1e3),v(g=!0)):($(this).attr("data-save",!1),v(g=!1))})),$(document).on("change","#use-library",(function(){_this=$(this).attr("data-lib"),"jquery"==_this?(console.log("use"),$(this).attr("data-lib","use-jquery")):(console.log("not use"),$(this).attr("data-lib","jquery"))})),$(document).on("change","#file-export",(function(){_this=$(this).val(),_id=`${createRandom(10)}-${createRandom(5)}-${createRandom(20)}`;let e=Object.values(y("renderCode"));"export"==_this?""!=e[0].trim()||""!=e[1].trim()||""!=e[2].trim()?($(this).val("exporting"),dataJSON="text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(y("renderCode"))),c.append(`<a href="data:${dataJSON}" download="${_id}.json">(tải xuống)</a>`)):($(this).prop("checked",!1),alertPopup(m[y("settingPage").language].autosaveEnable,m[y("settingPage").language].tryagain,3e3)):($(this).val("export"),c.html(""))})),$(document).on("change","#open-file-import",(function(){_this=$(this).val(),_value=$(this).prop("files"),"import"==_this?""!=y("renderCode")&&($(this).val("importing"),$("#data-import").append('<input type="file" id="file-import" value="import">')):($(this).val("import"),l.html(""))})),$(document).on("change","#file-import",(function(e){return _this=e.target.files[0].name.split(".")[1].toLowerCase(),"json"==_this?function(e){var t=e.target.files;if(null==t||0==t.length)return;var a=t[0],n=new FileReader;n.onload=function(e){var t,a,n;t=e.target.result,a=JSON.parse(t),"html"==(n=Object.keys(a))[0]&&"css"==n[1]&&"js"==n[2]?(C("renderCode",a),d.setValue(a.html),h.setValue(a.css),p.setValue(a.js),u.val("import").prop("checked",!1),l.html(""),v(g=!0),$("#auto-save").attr("data-save",!0).prop("checked",!0)):alertPopup(m[y("settingPage").language].jsonnotallow,m[y("settingPage").language].tryagain,3e3)},n.readAsText(a)}(e):alertPopup(m[y("settingPage").language].jsonincorrect,m[y("settingPage").language].tryagain,3e3)})),alertPopup=(t,a,n)=>{clearTimeout(e),i.html(t).addClass("alert"),e=setTimeout(()=>{i.html(a)},n),e=setTimeout(()=>{i.removeClass("alert")},n+1e3)},createRandom=e=>{for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,o=0;o<e;o++)t+=a.charAt(Math.floor(Math.random()*n));return t}}));