$((function(){var e,t,a=null!=C("settingPage")?C("settingPage"):[],r=null!=C("renderCode")?C("renderCode"):[],o=""!=a&&JSON.parse(a.autoSave),i=(""!=a&&JSON.parse(a.autoFormat),""!=a&&JSON.parse(a.useLibraryJS)),s=$("#popup-alert"),n=$("#data-import"),l=$("#open-file-import"),u=$("#data-export"),c=o,p=CodeMirror.fromTextArea($("#htmlCode")[0],{lineNumbers:!0,tabSize:5,mode:"text/xml",keyMap:"sublime",profile:"xhtml",theme:"material-darker",lint:!0,lineWrapping:!0,autoCloseTags:!0,autoCloseBrackets:!0,matchTags:{bothTags:!0},extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-J":"toMatchingTag"}}),m=CodeMirror.fromTextArea($("#cssCode")[0],{lineNumbers:!0,tabSize:5,mode:"css",keyMap:"sublime",profile:"css",theme:"material-darker css",lint:!0,lineWrapping:!0,autoCloseBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete"}}),h=CodeMirror.fromTextArea($("#jsCode")[0],{lineNumbers:!0,tabSize:5,keyMap:"sublime",theme:"material-darker js",mode:"text/javascript",lint:!0,autoCloseBrackets:!0,lineWrapping:!0});function d(t,a,r){clearTimeout(e),e=setTimeout(()=>{!function(e,t){1==e&&1==t&&f();var a=p.getValue(),r=`<style>${m.getValue()}</style>`,o=`<script type="text/javascript">${h.getValue()}<\/script>`,i=$("#preview-window")[0].contentWindow.document;i.open(),i.write(r,a,o),i.close()}(a,r)},t)}function g(e=o,t=i){v("settingPage",{autoSave:e,autoFormat:!1,useLibraryJS:i})}function f(e,t,a,r){v("renderCode",{html:p.getValue(),css:m.getValue(),js:h.getValue()})}function v(e,t){localStorage.setItem(e,JSON.stringify(t))}function C(e){var t=JSON.parse(localStorage.getItem(e));return t||[]}function b(e){clearTimeout(t),t=setTimeout(()=>{$(".menu-right .alert-processing").html('<label>Processing preview &nbsp;</label><i class="fal fa-spin fa-spinner-third"></i>')},e),t=setTimeout(()=>{$(".menu-right .alert-processing").html('<label>Processed preview &nbsp;</label><i class="fal fa-check"></i>')},e+1e3),t=setTimeout(()=>{$(".menu-right .alert-processing").html("<label>Status</label>")},e+2e3)}emmetCodeMirror(p),emmetCodeMirror(m),g(),b(0),d(0,c,!1),1==c&&($("#auto-save").attr("data-save",!0).attr("checked",!0),""!=r&&(p.setValue(r.html),m.setValue(r.css),h.setValue(r.js))),p.on("keypress",(function(){})),m.on("keypress",(function(){CodeMirror.commands.autocomplete(m)})),h.on("keypress",(function(){CodeMirror.commands.autocomplete(h)})),p.on("change",(function(){d(1500,c,!0),b(1e3)})),m.on("change",(function(){d(1500,c,!0),b(1e3)})),h.on("change",(function(){d(1500,c,!0),b(1e3)})),$(document).on("change","#auto-save",(function(){_this=$(this).attr("data-save"),"false"==_this?($(this).attr("data-save",!0),f(),b(1e3),g(c=!0)):($(this).attr("data-save",!1),g(c=!1))})),$(document).on("change","#use-library",(function(){_this=$(this).attr("data-lib"),"jquery"==_this?(console.log("use"),$(this).attr("data-lib","use-jquery")):(console.log("not use"),$(this).attr("data-lib","jquery"))})),$(document).on("change","#file-export",(function(){_this=$(this).val(),_id=`${createRandom(10)}-${createRandom(5)}-${createRandom(20)}`,"export"==_this?""!=C("renderCode")?($(this).val("exporting"),dataJSON="text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(C("renderCode"))),u.append(`<a href="data:${dataJSON}" download="${_id}.json">(tải xuống)</a>`)):($(this).prop("checked",!1),alertPopup("Chưa có dữ liệu để xuất, chế độ xuất chỉ sử dụng được khi lần đầu bật auto save!","Sorry...!",5e3)):($(this).val("export"),u.html(""))})),$(document).on("change","#open-file-import",(function(){_this=$(this).val(),_value=$(this).prop("files"),"import"==_this?""!=C("renderCode")?($(this).val("importing"),n.append('<input type="file" id="file-import" value="import">')):($(this).prop("checked",!1),alertPopup("Chế độ Import chỉ sử dụng được khi lần đầu bật auto save!","Sorry...!",5e3)):($(this).val("import"),n.html(""))})),$(document).on("change","#file-import",(function(e){return _this=e.target.files[0].name.split(".")[1].toLowerCase(),"json"==_this?function(e){var t=e.target.files;if(null==t||0==t.length)return;var a=t[0],r=new FileReader;r.onload=function(e){var t,a,r;t=e.target.result,a=JSON.parse(t),"html"==(r=Object.keys(a))[0]&&"css"==r[1]&&"js"==r[2]?(v("renderCode",a),p.setValue(a.html),m.setValue(a.css),h.setValue(a.js),l.val("import").prop("checked",!1),n.html("")):alertPopup("Không phải file chúng tôi!","Sorry...!",2e3)},r.readAsText(a)}(e):alertPopup("Vui lòng chọn đúng file JSON của chúng tôi!","Sorry...!",5e3)})),alertPopup=(t,a,r)=>{clearTimeout(e),s.html(t).addClass("alert"),e=setTimeout(()=>{s.html(a)},r),e=setTimeout(()=>{s.removeClass("alert")},r+1e3)},createRandom=e=>{for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=a.length,o=0;o<e;o++)t+=a.charAt(Math.floor(Math.random()*r));return t}}));