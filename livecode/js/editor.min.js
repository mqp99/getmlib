$((function(){var e,t=null!=v("settingPage")?v("settingPage"):[],a=null!=v("renderCode")?v("renderCode"):[],o=""!=t&&JSON.parse(t.autoSave),r=(""!=t&&JSON.parse(t.autoFormat),""!=t&&JSON.parse(t.useLibraryJS)),n=$("#popup-alert"),i=$("#data-import"),s=$("#open-file-import"),l=$("#data-export"),u=o,c=CodeMirror.fromTextArea($("#htmlCode")[0],{lineNumbers:!0,tabSize:5,mode:"text/html",keyMap:"sublime",theme:"material-darker",lint:!0,lineWrapping:!0,autoCloseTags:!0,autoCloseBrackets:!0,matchTags:{bothTags:!0},extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-J":"toMatchingTag"}}),p=CodeMirror.fromTextArea($("#cssCode")[0],{lineNumbers:!0,tabSize:5,mode:"css",keyMap:"sublime",theme:"material-darker css",lint:!0,lineWrapping:!0,autoCloseBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete"}}),d=CodeMirror.fromTextArea($("#jsCode")[0],{lineNumbers:!0,tabSize:5,keyMap:"sublime",theme:"material-darker js",mode:"text/javascript",lint:!0,autoCloseBrackets:!0,lineWrapping:!0});function h(t,a,o){clearTimeout(e),e=setTimeout(()=>{!function(e,t){1==e&&1==t&&(g(),alertPopup("Đang lưu...","Đã lưu",1e3));var a=c.getValue(),o=`<style>${p.getValue()}</style>`,r=`<script type="text/javascript">${d.getValue()}<\/script>`,n=$("#preview-window")[0].contentWindow.document;n.open(),n.write(o,a,r),n.close()}(a,o)},t)}function m(e=o,t=r){f("settingPage",{autoSave:e,autoFormat:!1,useLibraryJS:r})}function g(e,t,a,o){f("renderCode",{html:c.getValue(),css:p.getValue(),js:d.getValue()})}function f(e,t){localStorage.setItem(e,JSON.stringify(t))}function v(e){var t=JSON.parse(localStorage.getItem(e));return t||[]}m(),h(0,u,!1),1==u&&($("#auto-save").attr("data-save",!0).attr("checked",!0),""!=a&&(c.setValue(a.html),p.setValue(a.css),d.setValue(a.js))),c.on("keypress",(function(){})),p.on("keypress",(function(){CodeMirror.commands.autocomplete(p)})),d.on("keypress",(function(){CodeMirror.commands.autocomplete(d)})),c.on("change",(function(){h(1500,u,!0)})),p.on("change",(function(){h(1500,u,!0)})),d.on("change",(function(){h(1500,u,!0)})),$(document).on("change","#auto-save",(function(){_this=$(this).attr("data-save"),"false"==_this?($(this).attr("data-save",!0),g(),alertPopup("Đang lưu...","Đã lưu",1e3),m(u=!0)):($(this).attr("data-save",!1),m(u=!1),alertPopup("Đang tắt...","Đã tắt",1e3))})),$(document).on("change","#use-library",(function(){_this=$(this).attr("data-lib"),"jquery"==_this?(console.log("use"),$(this).attr("data-lib","use-jquery")):(console.log("not use"),$(this).attr("data-lib","jquery"))})),$(document).on("change","#file-export",(function(){_this=$(this).val(),_id=`${createRandom(10)}-${createRandom(5)}-${createRandom(20)}`,"export"==_this?""!=v("renderCode")?($(this).val("exporting"),dataJSON="text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(v("renderCode"))),l.append(`<a href="data:${dataJSON}" download="${_id}.json">(tải xuống)</a>`)):($(this).prop("checked",!1),alertPopup("Chưa có dữ liệu để xuất, chế độ xuất chỉ sử dụng được khi lần đầu bật auto save!","Sorry...!",5e3)):($(this).val("export"),l.html(""))})),$(document).on("change","#open-file-import",(function(){_this=$(this).val(),_value=$(this).prop("files"),"import"==_this?""!=v("renderCode")?($(this).val("importing"),i.append('<input type="file" id="file-import" value="import">')):($(this).prop("checked",!1),alertPopup("Chế độ Import chỉ sử dụng được khi lần đầu bật auto save!","Sorry...!",5e3)):($(this).val("import"),i.html(""))})),$(document).on("change","#file-import",(function(e){return _this=e.target.files[0].name.split(".")[1].toLowerCase(),"json"==_this?function(e){var t=e.target.files;if(null==t||0==t.length)return;var a=t[0],o=new FileReader;o.onload=function(e){var t,a,o;t=e.target.result,a=JSON.parse(t),"html"==(o=Object.keys(a))[0]&&"css"==o[1]&&"js"==o[2]?(f("renderCode",a),c.setValue(a.html),p.setValue(a.css),d.setValue(a.js),s.val("import").prop("checked",!1),i.html("")):alertPopup("Không phải file chúng tôi!","Sorry...!",2e3)},o.readAsText(a)}(e):alertPopup("Vui lòng chọn đúng file JSON của chúng tôi!","Sorry...!",5e3)})),alertPopup=(t,a,o)=>{clearTimeout(e),n.html(t).addClass("alert"),e=setTimeout(()=>{n.html(a)},o),e=setTimeout(()=>{n.removeClass("alert")},o+1e3)},createRandom=e=>{for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=a.length,r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*o));return t}}));