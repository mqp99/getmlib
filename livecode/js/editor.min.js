$((function(){var e=null!=C("renderCode")?C("renderCode"):[];""!=e||b("renderCode",{html:"",css:"",js:""});var t=null!=C("settingPage")?C("settingPage"):[],a=""!=t&&JSON.parse(t.autoSave),n=""!=t?t.language:"en_us",o=""!=t&&JSON.parse(t.useLibraryJS),r=$("#popup-alert"),s=$("#data-import"),i=$("#data-export");__ID__autoSave=$("#auto-save"),__ID__openDataImport=$("#open-file-import");var l,u,c=a,g={vi_vn:{processing:'<label>Đang lưu &nbsp;</label><i class="fal fa-spin fa-spinner-third"></i>',processed:'<label>Đã lưu &nbsp;</label><i class="fal fa-check"></i>',status:'<label data-translate="_status">Trạng thái</label>',autosaveEnable:"Phải bật auto save và có nội dung!",tryagain:"Vui lòng thử lại!",jsonincorrect:"Vui lòng sử dụng đúng tệp JSON!",jsonnotallow:"JSON này không phải của chúng tôi!"},en_us:{processing:'<label>Code saving &nbsp;</label><i class="fal fa-spin fa-spinner-third"></i>',processed:'<label>Code saved &nbsp;</label><i class="fal fa-check"></i>',status:'<label data-translate="_status">Status</label>',autosaveEnable:"Turn on auto save and have code!",tryagain:"Please try again!",jsonincorrect:"Please use correct file JSON!",jsonnotallow:"This JSON is not allow!"}},m=CodeMirror.fromTextArea($("#htmlCode")[0],{lineNumbers:!0,tabSize:5,indentUnit:3,mode:"text/xml",keyMap:"sublime",profile:"xhtml",theme:"material-darker",lint:!0,lineWrapping:!0,autoCloseTags:!0,autoCloseBrackets:!0,matchTags:{bothTags:!0},extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-J":"toMatchingTag","Shift-F":function(){var e={from:m.getCursor(!0),to:m.getCursor(!1)};m.autoFormatRange(e.from,e.to)}}}),d=CodeMirror.fromTextArea($("#cssCode")[0],{lineNumbers:!0,tabSize:5,indentUnit:4,mode:"css",keyMap:"sublime",profile:"css",theme:"material-darker css",lineWrapping:!0,autoCloseBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete","Shift-F":function(){var e={from:d.getCursor(!0),to:d.getCursor(!1)};d.autoFormatRange(e.from,e.to)}}}),p=CodeMirror.fromTextArea($("#jsCode")[0],{lineNumbers:!0,tabSize:5,indentUnit:3,keyMap:"sublime",theme:"material-darker js",mode:"text/javascript",lint:!0,autoCloseBrackets:!0,lineWrapping:!0});function h(e,t,a){clearTimeout(l),l=setTimeout(()=>{!function(e,t){var a=m.getValue(),n=`<style type="text/css">${d.getValue()}</style>`,o=`<script type="text/javascript">${p.getValue()}<\/script>`,r=$("#preview-window").contents()[0];r.open(),r.write(n,a,o),r.close(),1==e&&1==t&&(v(),S(1e3))}(t,a)},e)}function f(e=a,t=o,r=n){b("settingPage",{autoSave:e,useLibraryJS:o,language:n})}function v(e,t,a,n){b("renderCode",{html:m.getValue(),css:d.getValue(),js:p.getValue()})}function b(e,t){localStorage.setItem(e,JSON.stringify(t))}function C(e){var t=JSON.parse(localStorage.getItem(e));return t||[]}function S(e){clearTimeout(u),u=setTimeout(()=>{$(".menu-right .alert-processing").html(g[C("settingPage").language].processing)},e),u=setTimeout(()=>{$(".menu-right .alert-processing").html(g[C("settingPage").language].processed)},e+1e3),u=setTimeout(()=>{$(".menu-right .alert-processing").html(g[C("settingPage").language].status)},e+2e3)}function _(e,t,a){clearTimeout(l),r.html(e).addClass("alert"),l=setTimeout(()=>{r.html(t)},a),l=setTimeout(()=>{r.removeClass("alert")},a+1e3)}function y(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,o=0;o<e;o++)t+=a.charAt(Math.floor(Math.random()*n));return t}emmetCodeMirror(m),emmetCodeMirror(d),f(),h(0,c,!1),1==c&&(__ID__autoSave.attr("data-save",!0),__ID__autoSave.attr("checked",!0),""!=e&&(m.setValue(e.html),d.setValue(e.css),p.setValue(e.js))),m.on("keypress",(function(){})),d.on("keypress",(function(){CodeMirror.commands.autocomplete(d)})),p.on("keypress",(function(){CodeMirror.commands.autocomplete(p)})),m.on("change",(function(){h(1e3,c,!0)})),d.on("change",(function(){h(1e3,c,!0)})),p.on("change",(function(){h(1e3,c,!0)})),$(document).on("click","#format-html",(function(){$(this).html("Formated"),setTimeout(()=>{$(this).html("Format")},1e3);var e=m.lineCount(),t=m.getValue().length;m.autoFormatRange({line:0,ch:0},{line:e,ch:t})})),$(document).on("click","#format-css",(function(){$(this).html("Formated"),setTimeout(()=>{$(this).html("Format")},1e3);var e=d.lineCount(),t=d.getValue().length;d.autoFormatRange({line:0,ch:0},{line:e,ch:t})})),$(document).on("change","#auto-save",(function(){"false"==$.attr(this,"data-save")?($.attr(this,"data-save",!0),v(),S(1e3),f(c=!0)):($.attr(this,"data-save",!1),f(c=!1))})),$(document).on("change","#use-library",(function(){"jquery"==$.attr(this,"data-lib")?$.attr(this,"data-lib","use-jquery"):$.attr(this,"data-lib","jquery")})),$(document).on("change","#file-export",(function(){let e=$(this),t=e.val(),a=`${y(10)}-${y(5)}-${y(20)}`,n=Object.values(C("renderCode"));"export"==t?""!=n[0].trim()||""!=n[1].trim()||""!=n[2].trim()?(e.val("exporting"),dataJSON=`text/json;charset=utf-8, ${encodeURIComponent(JSON.stringify(C("renderCode")))}`,i.append(` <a \thref="data:${dataJSON}" download="${a}.json"> (tải xuống) </a>`)):($.prop(this,"checked",!1),_(g[C("settingPage").language].autosaveEnable,g[C("settingPage").language].tryagain,3e3)):(e.val("export"),i.html(""))})),$(document).on("change","#open-file-import",(function(){let e=$(this);"import"==e.val()?""!=C("renderCode")&&(e.val("importing"),s.append('<input type="file" id="file-import" value="import">')):(e.val("import"),s.html(""))})),$(document).on("change","#file-import",(function(e){if(_this=e.target.files[0].name.split(".")[1].toLowerCase(),"json"==_this)return function(e){var t=e.target.files;if(null==t||0==t.length)return;var a=t[0],n=new FileReader;n.onload=function(e){var t,a,n;t=e.target.result,a=JSON.parse(t),"html"==(n=Object.keys(a))[0]&&"css"==n[1]&&"js"==n[2]?(b("renderCode",a),m.setValue(a.html),d.setValue(a.css),p.setValue(a.js),__ID__openDataImport.val("import").prop("checked",!1),s.html(""),f(c=!0),__ID__autoSave.attr("data-save",!0).prop("checked",!0)):_(g[C("settingPage").language].jsonnotallow,g[C("settingPage").language].tryagain,3e3)},n.readAsText(a)}(e);_(g[C("settingPage").language].jsonincorrect,g[C("settingPage").language].tryagain,3e3)}))}));